# IP

ipモジュールは列挙値をIPタイプに変換し、オプションでフィルタリングを実行できます。  これにより、ユーザーは、たとえば、JSON構造からIPアドレスを含む文字列を抽出し、ipモジュールを使用してその文字列をIPアドレスに変換し、それが特定のサブネット内にあるかどうかを確認できます。

## サポートされているオプション

* `-or`: "-or"フラグは、フィルタのどれかが成功した場合に、ipモジュールがエントリをパイプラインに沿って続けることを許可することを指定します。

## 処理オペレータ

ipモジュールに渡された列挙値は、次の演算子を使用してIPアドレスまたはサブネットと比較できます。

| オペレーター | 名 | 説明 |
|----------|------|-------------|
| == | 等しい | フィールドは等しくなければなりません
| != | 等しくない | フィールドは等しくてはいけませんl
| ~ | サブセット | フィールドに値が含まれています
| !~ | サブセットではない | フィールドに値が含まれていません

pモジュールは、標準のプライベートネットワークのいずれかに一致するようにキーワードPRIVATEを定義します:

* 10.0.0.0/8
* 172.16.0.0/12
* 192.168.0.0/16
* 127.0.0.0/8
* 224.0.0.0/24
* 169.254.0.0/16
* fd00::/8
* fe80::/10

## 例

### 文字列をIPに変換する

'ipaddr'フィールドを含むJSON形式のエントリを想定して、そのフィールドを抽出して後で使用するためにIPアドレスに変換します:

```
tag=json json ipaddr | ip ipaddr
```

結果のIP列挙値は、元のものを上書きするのではなく、別の列挙値名に割り当てることもできます:

```
tag=json json ipaddr | ip ipaddr as IP
```

### アドレスまたはサブネットでフィルタリングする

3番目のフィールドに接続の送信元IPアドレスが記述されているCSV形式のデータを想定すると、192.168.1.5から発信されていないすべての接続をドロップできます:

```
tag=csv csv [2] as srcip | ip srcip==192.168.1.5
```

ローカルサブネットから発生した接続を排除することもできます:

```
tag=csv csv [2] as srcip | ip srcip !~ 192.168.0.0/16
```

### PRIVATEキーワードを使用する

3番目のフィールドに接続の送信元IPアドレスが記述されているCSV形式のデータを想定すると、ipモジュールを使用して、プライベートネットワークから送信されたエントリだけを保持できます:

```
tag=csv csv [2] as srcip | ip srcip ~ PRIVATE
```
